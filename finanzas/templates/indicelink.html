{% extends "users/inicio2.html" %}

{% load static %}
{% load humanize %}

{% block content %}

<div class="container-fluid r-aside">
    <!-- ============================================================== -->
    <!-- Bread crumb and right sidebar toggle -->
    <!-- ============================================================== -->
    <div class="row page-titles">
        <div class="col-md-5 align-self-center">
            <h3 class="text-themecolor">Indice Link</h3>
        </div>

    </div>

  </div>


  

  <div class="col-12">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Composición del indice</h4>
            <h6 class="card-subtitle">Resumen de los datos conjuntos de proyectos y honorarios</h6>
            <div style="text-align: left; margin: 5px;">

                <a class="dropbtn btn btn-info" href="{% url 'Indice Link' %}" >Pesos</a>
            
                <a class="dropbtn btn btn-dark" href="{% url 'Indice Link moneda' 7 %}" >Hormigon</a>
            
                <a class="dropbtn btn btn-success" href="{% url 'Indice Link moneda' 2 %}" >U.S.D.</a>
            
                </div>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Proyecto</th>
                            <th>Saldo de caja</th>
                            <th>Pend. Gasto</th>
                            <th>Pend. Ingreso</th>
                            <th>Margen</th>
                            <th>Descuentos</th>
                            <th>Margen final</th>
  
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in datos_completos %}  
    
                        <tr class = "table-light">
        
                            {% if "#300" in i.0.proyecto.nombre %}
        
                            <td> 
                                
                                <div>
        
                                    <img src="{{i.0.proyecto.iamgen.url}}"  class="img-fluid" alt="..." style="max-width: 70px; height:auto;">
                                
                                </div>
        
                                <span class="label label-info" style="background-color: rgb({{i.0.proyecto.color}});">#300</span>
                                 
                            
                            </td> 
                            
                            {% else %}
        
                            <td>
        
        
                                <div>
        
                                    <img src="{{i.0.proyecto.iamgen.url}}"  class="img-fluid" alt="..." style="max-width: 70px; height:auto;">
                                
                                </div>
        
                                <span class="label label-info" style="background-color: rgb({{i.0.proyecto.color}});">{{ i.0.proyecto.nombre}}</span>                  
                            
                            </td> 
                            
        
                            {% endif %}
                            
                            
                            <td style="width: 10%; vertical-align: middle;"><small>$ {{ i.1|floatformat:0|intcomma }}</small> </td> 
                            <td style="width: 10%; vertical-align: middle;"><small>$ {{ i.2|floatformat:0|intcomma }}</small> </td> 
                            <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small>$ {{ i.3|floatformat:0|intcomma }}</small></td> 
                            <td style="width: 8%; vertical-align: middle;"><small><b>$ {{i.4|floatformat:0|intcomma }}</b></small></td>
                            <td style="width: 10%; vertical-align: middle;"><small>- $ {{ i.5|floatformat:0|intcomma }}</small> </td> 
                            <td style="width: 10%; vertical-align: middle;"><small><b>$ {{ i.6|floatformat:0|intcomma }}</b> </small> </td>     
                        </tr>
                    </tbody>
        
                    {% endfor %}
        
                    <tbody>
            
                        <tr class = "table-dark">
                            <td style="width: 10%; vertical-align: middle;"><small><b>RESULTADO</b></small> </td>
                            <td  class="priority-5" style="width: 5%; vertical-align: middle;"><small><b>$ {{datos_finales.0.0|floatformat:0|intcomma }}</b> </small> </td> 
                            <td  class="priority-5" style="width: 10%; vertical-align: middle;"><small><b>$ {{datos_finales.0.1|floatformat:0|intcomma }}</b></small> </td> 
                            <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small><b>$ {{datos_finales.0.2|floatformat:0|intcomma}}</b></small> </td> 
                            <td style="width: 10%; vertical-align: middle;"><small><b>$ {{datos_finales.0.4|floatformat:0|intcomma }}</b></small> </td>
                            <td style="width: 10%; vertical-align: middle;"><small><b>- $ {{ datos_finales.0.3|floatformat:0|intcomma}}</b></small> </td> 
                            <td style="width: 10%; vertical-align: middle;"><small><b>$ {{ datos_finales.0.5|floatformat:0|intcomma }}</b></small> </td>
                    </tr>
                        <tr class = "table-light">
                            <td style="width: 10%; vertical-align: middle;"><small><b>HONORARIOS</b></small></td>
                            <td  class="priority-5" style="width: 5%; vertical-align: middle;"><small>$ {{datos_finales_2.11|floatformat:0|intcomma }}</small></td> 
                            <td  class="priority-5" style="width: 10%; vertical-align: middle;"><small>$ {{datos_finales_2.2|floatformat:0|intcomma }}</small></td> 
                            <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small><b>$ {{datos_finales_2.1|floatformat:0|intcomma }}</b></small></td> 
                            <td style="width: 10%; vertical-align: middle;"><small><b>$ {{datos_finales_2.0|floatformat:0|intcomma }}</b></small></td>
                            <td style="width: 10%; vertical-align: middle; vertical-align: middle;"></td> 
                            <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small><b>$ {{datos_finales_2.3|floatformat:0|intcomma }}</b></small></td>
        
                        </tr>
                        <tr class = "table-dark">
                            <td style="width: 10%; vertical-align: middle;"> <small><b>RESULTADO</b></small> </td>
                            <td  class="priority-5" style="width: 5%; vertical-align: middle;"><small><b>$ {{datos_finales_2.12|floatformat:0|intcomma }}</b></small></td> 
                            <td  class="priority-5" style="width: 10%; vertical-align: middle;"><small><b>$ {{datos_finales_2.5|floatformat:0|intcomma }}</b></small></td> 
                            <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small><b>$ {{datos_finales_2.4|floatformat:0|intcomma }}</b></small></td> 
                            <td style="width: 10%; vertical-align: middle;"><small><b>$ {{datos_finales_2.6|floatformat:0|intcomma }}</b></small></td>
                            <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small><b>- $ {{ datos_finales.0.3|floatformat:0|intcomma}}</b></small> </td> 
                            <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small><b>$ {{datos_finales_2.7|floatformat:0|intcomma }}</b></small> </td>
                        </tr>
                    </tbody>

                </table>
            </div>
        </div>
    </div>
</div>


    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <div class="d-flex">
                    <div>
                        <h3 class="card-title m-b-5"><span class="lstick"></span>Variación del indice</h3>
                        <h6 class="card-subtitle">Registros de los datos</h6></div>

                    </div>


                        <canvas id="myChart" height="100px" ></canvas>
                    
                

    </div>
    </div>
    </div>




    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'line',

            // The data for our dataset
            data: {

                labels: [
                    {% for i in fechas %}
                    '{{i}}',                   
                    {% endfor %}
                    'Hoy'
                    ],
                datasets: [

                {
                    label: 'Valor final',
                    backgroundColor: 'rgb(132, 200, 65, 0.5)',
                    borderColor: 'rgb(132, 200, 65)',
                    fill: true,
                    borderWidth: 1,
                    lineTension: 0,
                    data: [
                    {% for i in datos_registro  %}
                    Math.round({{i.1|floatformat:0}}/1000000),  
                                     
                    {% endfor %}
                    Math.round({{datos_finales_2.7|floatformat:0 }}/1000000),
                    ]
                },

                {
                    label: 'Valor antes de descuento',
                    backgroundColor: 'rgb(87, 112, 63, 0.5)',
                    borderColor: 'rgb(87, 112, 63)',
                    fill: '-1',
                    borderWidth: 1,
                    lineTension: 0,
                    data: [
                    {% for i in datos_registro %}
                    Math.round({{i.0|floatformat:0}}/1000000),                   
                    {% endfor %}
                    Math.round({{datos_finales_2.6|floatformat:0 }}/1000000),
                    ]
                }],

            },

            // Configuration options go here
            options: {

                scales: {

                    xAxes: [
                        {

                            stacked: true,
                            display: false,

                        }
                    ],
                    yAxes: [
                        {
                            ticks: {
                                min: 0,
                                stepSize: 50,
                                callback: function(label, index, labels) {
                                    return '$ '+label+ ' M';
                                    
                                }
                            },
                            scaleLabel: {
                                display: true,
                                labelString: '1M = $1.000.000'
                            },

                            stacked: false
                        }
                    ],
                },
            }

        });

        
    </script>


 
{% endblock %}