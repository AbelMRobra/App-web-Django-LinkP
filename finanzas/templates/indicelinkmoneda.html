{% extends "users/inicio.html" %}

{% load static %}
{% load humanize %}

{% block content %}



<div class = "jumbotron" style="background-color: white; margin-bottom: 0px; text-align: center;" > 

    <div >

        
            {% if moneda.id == 7 %}
            
            <h2 style="font-family: Arial, Helvetica, sans-serif; color: rgb(118, 125, 123);">Indice LINK - Hº Vivienda</h2> 
                             
            {% else %}
  

            <h2 style="font-family: Arial, Helvetica, sans-serif; color: rgb(23, 185, 149);">Indice LINK - USD BLUE</h2> 

            {% endif %}


        <small style="font-family: Arial, Helvetica, sans-serif;"><b>Modulo:</b> Finanzas </small>


        <b><hr class = "my-4" style="width: 100%; "></b>
    
    </div>


    <div>


        <div style="text-align: left;  margin: 5px;">

            <a class="badge badge-dark" href="{% url 'Indice Link' %}" >PESOS</a>
    
            <a class="badge badge-secondary" href="{% url 'Indice Link moneda' 7 %}" >HORMIGON</a>

            <a class="badge badge-success" href="{% url 'Indice Link moneda' 2 %}" >USD</a>

            </div>
        <table class = "table table-hover" style="text-align: center;">
            <thead>
    
                <tr class = "table-dark">
                    <th scope = "row" style="vertical-align: middle;"><small><b>PROYECTO</b></small></th>                   
                    <th scope = "row" style="vertical-align: middle;"><small><b>SALDO DE CAJA</b></small></th>
                    <th scope = "row" style="vertical-align: middle;"><small><b>PEND. GASTO</b></small></th>
                    <th scope = "row" style="vertical-align: middle;"><small><b>PEND. INGRESO</b></small></th>
                    <th scope = "row" style="vertical-align: middle;"><small><b>MARGEN</b></small> </th>
                    <th scope = "row" style="vertical-align: middle;"><small><b>DESCUENTOS</b></small></th>
                    <th scope = "row" style="vertical-align: middle;"><small><b>MARGEN FINAL</b></small></th>
                </tr>
            </thead>
            {% for i in datos_completos %}   
            <tbody>
    
                <tr class = "table-light">


                    {% if "#300" in i.0.proyecto.nombre %}

                    <td style="color: rgb({{i.0.proyecto.color}}); vertical-align: middle;"> 
                        
                        <div>

                            <img src="{{i.0.proyecto.iamgen.url}}"  class="img-fluid" alt="..." style="max-width: 70px; height:auto;">
                        
                        </div>

                        <small><b>#300</b></small>
                         
                    
                    </td> 
                    
                    {% else %}

                    <td style="width: 10%; color: rgb({{i.0.proyecto.color}}); vertical-align: middle;">


                        <div>

                            <img src="{{i.0.proyecto.iamgen.url}}"  class="img-fluid" alt="..." style="max-width: 70px; height:auto;">
                        
                        </div>

                        <small><b>{{ i.0.proyecto.nombre}}</b> </small>                  
                    
                    </td> 
                    

                    {% endif %}
                    
                    
                    <td style="width: 10%; vertical-align: middle;"><small>

                        {% if moneda.id == 7 %}

                        {{ i.1|floatformat:0|intcomma }} M3
                    
                                        
                        {% else %}

                        U$D {{ i.1|floatformat:0|intcomma }}
                    

                        {% endif %}
                    
                    
                    </small> </td> 
                    <td style="width: 10%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        {{ i.2|floatformat:0|intcomma }} M3
                    
                                        
                        {% else %}

                        U$D {{ i.2|floatformat:0|intcomma }}
                    

                        {% endif %}

                    </small> </td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        {{ i.3|floatformat:0|intcomma }} M3
                    
                                        
                        {% else %}

                        U$D {{ i.3|floatformat:0|intcomma }}
                    

                        {% endif %}
     
                    </small></td> 
                    <td style="width: 8%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{i.4|floatformat:0|intcomma }} M3</b>
                    
                                        
                        {% else %}

                        <b>U$D {{i.4|floatformat:0|intcomma }}</b>
                    

                        {% endif %}
    
                    </small></td>
                    <td style="width: 10%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        - {{ i.5|floatformat:0|intcomma }} M3
                    
                                        
                        {% else %}

                        - U$D {{ i.5|floatformat:0|intcomma }}
                    

                        {% endif %}
 
                    </small> </td> 
                    <td style="width: 10%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{ i.6|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{ i.6|floatformat:0|intcomma }}</b> 
                    

                        {% endif %}
 
                    </small> </td>     
                </tr>
            </tbody>

            {% endfor %}

            <tbody>
    
                <tr class = "table-dark">
                    <td style="width: 10%; vertical-align: middle;"><small>
                        <b>RESULTADO PROYECTOS</b>
                    </small> </td>
                    <td  class="priority-5" style="width: 5%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{datos_finales.0.0|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales.0.0|floatformat:0|intcomma }}</b>
                    

                        {% endif %}
 
                    </small> </td> 
                    <td  class="priority-5" style="width: 10%; vertical-align: middle;"><small>

                        {% if moneda.id == 7 %}

                        <b>{{datos_finales.0.1|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales.0.1|floatformat:0|intcomma }}</b>
                    

                        {% endif %}

                        
                    </small> </td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{datos_finales.0.2|floatformat:0|intcomma}} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales.0.2|floatformat:0|intcomma}}</b>
                    

                        {% endif %}
                        </small> 
                    </td> 
                    <td style="width: 10%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{datos_finales.0.4|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales.0.4|floatformat:0|intcomma }}</b>
                    

                        {% endif %}
                        
                        
                    </small> </td>
                    <td style="width: 10%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>- {{ datos_finales.0.3|floatformat:0|intcomma}} M3</b> 
                    
                                        
                        {% else %}

                        <b>- U$D {{ datos_finales.0.3|floatformat:0|intcomma}}</b>
                    

                        {% endif %}
                

                    </small> </td> 
                    <td style="width: 10%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{ datos_finales.0.5|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{ datos_finales.0.5|floatformat:0|intcomma }}</b>
                    

                        {% endif %}
                
                    </small> </td>
            </tr>
                <tr class = "table-light">
                    <td style="width: 10%; vertical-align: middle;"><small><b>HONORARIOS</b></small></td>
                    <td  class="priority-5" style="width: 5%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        {{datos_finales_2.11|floatformat:0|intcomma }} M3
                    
                                        
                        {% else %}

                        U$D {{datos_finales_2.11|floatformat:0|intcomma }}
                    

                        {% endif %}
                        </small>
                    </td> 
                    <td  class="priority-5" style="width: 10%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                         {{datos_finales_2.2|floatformat:0|intcomma }} M3
                    
                                        
                        {% else %}

                        U$D {{datos_finales_2.2|floatformat:0|intcomma }}
                    

                        {% endif %}
                        </small>
                    </td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{datos_finales_2.1|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales_2.1|floatformat:0|intcomma }}</b>
                    

                        {% endif %}
                        
                    </small></td> 
                    <td style="width: 10%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{datos_finales_2.0|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales_2.0|floatformat:0|intcomma }}</b>
                    

                        {% endif %}
     
                    </small></td>
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;"></td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;">

                    <small>

                        {% if moneda.id == 7 %}

                        <b>{{datos_finales_2.3|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales_2.3|floatformat:0|intcomma }}</b>
                    

                        {% endif %}

                    </small>

                    </td>

                </tr>
                <tr class = "table-dark">
                    <td style="width: 10%; vertical-align: middle;"> <small><b>RESULTADO COMPLETO</b></small> </td>
                    <td  class="priority-5" style="width: 5%; vertical-align: middle;"><small>

                        {% if moneda.id == 7 %}

                        <b>{{datos_finales_2.12|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales_2.12|floatformat:0|intcomma }}</b>
                    

                        {% endif %}

                    </small></td> 
                    <td  class="priority-5" style="width: 10%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{datos_finales_2.5|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales_2.5|floatformat:0|intcomma }}</b>
                    

                        {% endif %}
   
                    </small></td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{datos_finales_2.4|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales_2.4|floatformat:0|intcomma }}</b>
                    

                        {% endif %}

                    </td> 
                    <td style="width: 10%; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{datos_finales_2.6|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales_2.6|floatformat:0|intcomma }}</b>
                    

                        {% endif %}
                        
                    </small></td>
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small>
                        {% if moneda.id == 7 %}

                        <b>{{ datos_finales.0.3|floatformat:0|intcomma}} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{ datos_finales.0.3|floatformat:0|intcomma}}</b>
                    

                        {% endif %}

                    </small> </td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;"><small>

                        {% if moneda.id == 7 %}

                        <b>{{datos_finales_2.7|floatformat:0|intcomma }} M3</b> 
                    
                                        
                        {% else %}

                        <b>U$D {{datos_finales_2.7|floatformat:0|intcomma }}</b>
                    

                        {% endif %}
         
                    </small></td>
                </tr>
            </tbody>



        </table> 


          
   </div>

   <b><hr class = "my-4" style="width: 100%; "></b> 

   <div style="margin-bottom: 2rem;">
    <h5 style="font-family: Arial, Helvetica, sans-serif;">Variación historica del Indice</h5>
</div>

    <div style="margin-top: 0.5rem; width: 100%;">

        <div style= "text-align: center;">
            <small><strong>-- Valor del indice --</strong></small>
        </div>

        <canvas id="myChart" height="70px" width="auto"></canvas>


    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'line',

            // The data for our dataset
            data: {

                labels: [
                    {% for i in fechas %}
                    '{{i}}',                   
                    {% endfor %}
                    'Hoy'
                    ],
                datasets: [

                {
                    label: 'Valor final',

                    {% if moneda.id == 7 %}
                    backgroundColor: 'rgb(80, 86, 74, 0.5)',
                    borderColor: 'rgb(80, 86, 74, 65)',

                    {% else %}

                    backgroundColor: 'rgb(23, 185, 92 , 0.5)',
                    borderColor: 'rgb(23, 185, 92, 65)',

                    {% endif %}

                    fill: true,
                    borderWidth: 1,
                    lineTension: 0,
                    data: [

                    {% if moneda.id == 7 %}
                    {% for i in datos_registro  %}
                    Math.round({{i.1|floatformat:0}}/1000),  
                                     
                    {% endfor %}
                    Math.round({{datos_finales_2.7|floatformat:0}}/1000),
                    ]

                    {% else %}


                    {% for i in datos_registro  %}
                    Math.round({{i.1|floatformat:0}}/1000),  
                                     
                    {% endfor %}
                    Math.round({{datos_finales_2.7|floatformat:0}}/1000),
                    ]

                    {% endif %}
                },

                {
                    label: 'Valor antes de descuento',
                    {% if moneda.id == 7 %}
                    backgroundColor: 'rgb(9, 10, 10 , 0.5)',
                    borderColor: 'rgb(9, 10, 10 )',

                    {% else %}

                    backgroundColor: 'rgb(23, 185, 149 , 0.5)',
                    borderColor: 'rgb(23, 185, 149 )',

                    {% endif %}
                    fill: '-1',
                    borderWidth: 1,
                    lineTension: 0,
                    data: [

                    {% if moneda.id == 7 %}


                    {% for i in datos_registro %}
                    Math.round({{i.0|floatformat:0}}/1000),                   
                    {% endfor %}
                    Math.round({{datos_finales_2.6|floatformat:0}}/1000),


                    {% else %}

                    {% for i in datos_registro %}
                    Math.round({{i.0|floatformat:0}}/1000),                   
                    {% endfor %}
                    Math.round({{datos_finales_2.6|floatformat:0}}/1000),

                    {% endif %}
                    ]
                }],

            },

            // Configuration options go here
            options: {

                scales: {

                    xAxes: [
                        {

                            stacked: true,
                            display: false,

                        }
                    ],
                    yAxes: [
                        {
                            ticks: {
                                min: 0,
                                callback: function(label, index, labels) {

                                    {% if moneda.id == 7 %}
                                    return label+ ' Mil M3';
                                    
                                    {% else %}

                                    return 'U$D '+label+ ' Mil';

                                    {% endif %}
                                    
                                }
                            },
                            scaleLabel: {
                                display: true,
                            },

                            stacked: false
                        }
                    ],
                },
            }

        });
        

        
    </script>


    </div>

    <div>
        <small>* Se utiliza la cotización del primer dia habil del mes</small>
    </div>


    <div>
        <p style="font-family: Arial, Helvetica, sans-serif;"> <small>-- Link<strong>P</strong> --</small> </p>

     </div>


</div>
{% endblock %}