{% extends "users/inicio.html" %}

{% load static %}
{% load humanize %}

{% block content %}



<div class = "jumbotron" style="background-color: white; margin-bottom: 0px; text-align: center;" > 

    <div >
        <h2 style="font-family: Arial, Helvetica, sans-serif;">Indice LINK</h2>

        <small style="font-family: Arial, Helvetica, sans-serif;"><b>Modulo:</b> Finanzas </small>


        <b><hr class = "my-4" style="width: 100%; "></b>
    
    </div>


    <div>

        <div style="margin-bottom: 2rem;">
            <h5 style="font-family: Arial, Helvetica, sans-serif;">Detalle por proyecto</h5>
        </div>

        <div style="text-align: left;">

            <a class="badge badge-dark" href="{% url 'Consolidado' %}" >PESOS</a>
    
            <a class="badge badge-secondary" href="{% url 'Consolidado H' %}" >HORMIGON</a>

            </div>
        <table class = "table table-hover" style="text-align: center;">
            <thead>
    
                <tr class = "table-dark">
                    <th scope = "row" style="vertical-align: middle;" colspan="2">  PROYECTO </th>                   
                    <th scope = "row" style="vertical-align: middle;" class="priority-4"> INGRESOS</th>
                    <th scope = "row" style="vertical-align: middle;" class="priority-4"> COSTOS</th>
                    <th scope = "row" style="vertical-align: middle;"> BENEFICIOS</th>
                    <th scope = "row" style="vertical-align: middle;"> RENDIMIENTO</th>
                    <th scope = "row" style="vertical-align: middle;" class="priority-5"> <span class="hint--left hint--info" aria-label="Esta columna indica si tiene pricing asociado!">PRICING</span> </th>
                    <th scope = "row" style="vertical-align: middle;" class="priority-5"><span class="hint--top hint--danger" aria-label= "Precio promedio contado de las unidades disponibles">CONT.PROM.DISP.</span></th>
                    <th scope = "row" style="vertical-align: middle;" class="priority-5"> <span class="hint--left hint--info" aria-label="Esta columna indica si tiene un presupuesto calculado!">PRESUPUESTO</span> </th>

                   
                </tr>
            </thead>
            {% for i in datos_completos %}   
            <tbody>
    
                <tr class = "table-light">


                    <td style="vertical-align: middle;"> <img src="{{i.0.proyecto.iamgen.url}}"  class="img-fluid" alt="..." style="max-width: 70px; height:auto;"> </td>
                    
                    {% if "#300" in i.0.proyecto.nombre %}

                    <td style="color: rgb({{i.0.proyecto.color}}); vertical-align: middle;"> <b>#300 (PROYECTO COMPLETO)</b> </td> 
                    
                    {% else %}

                    <td style="width: 10%; color: rgb({{i.0.proyecto.color}}); vertical-align: middle;"> <b>{{ i.0.proyecto.nombre}}</b> </td> 
                    

                    {% endif %}
                    
                    
                    <td class="priority-4" style="width: 5%; vertical-align: middle;"> ${{ i.2|floatformat:0|intcomma }}</td> 
                    <td class="priority-4" style="width: 10%; vertical-align: middle;">${{ i.1|floatformat:0|intcomma }}</td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;">${{ i.3|floatformat:0|intcomma }}</td> 
                    <td style="width: 10%; vertical-align: middle;">{{ i.4|floatformat:0|intcomma }}%  </td> 
                    
                    {% if i.6 > 0 %}
                    
                    <td class="priority-5" style="width: 10%; vertical-align: middle; color: #3FB360;"><b>  CARGADO</b></td> 
                    
                    {% else %}

                    <td class="priority-5" style="width: 10%; vertical-align: middle; color: #B3513F ;"> <b>NO CARGADO</b></td> 

                    {% endif %}

                    <td class="priority-4" style="width: 5%; vertical-align: middle;"> ${{ i.9|floatformat:0|intcomma }}</td>

                    {% if i.5 > 200 %}
                    
                    <td class="priority-5" style="width: 10%; vertical-align: middle; color: #3FB360;"><b>CALCULADO</b></td> 

                    
                    {% elif i.5 > 100 %}
                    
                    <td class="priority-5" style="width: 10%; vertical-align: middle; color: #DBCD23 ;"><b>SEMI-CALCULADO</b></td> 
                    
                    {% else %}

                    <td class="priority-5" style="width: 10%; vertical-align: middle; color: #B3513F ;"> <b>EXTRAPOLADO</b></td> 

                    {% endif %}

                </tr>
            </tbody>

            {% endfor %}

            <tbody>
    
                <tr class = "table-light">
                    <td style="width: 15%; vertical-align: middle;" colspan="2"> RESULTADO  </td>
                    <td  class="priority-5" style="width: 5%; vertical-align: middle;"> ${{ datos_finales.0.0|floatformat:0|intcomma }}</td> 
                    <td  class="priority-5" style="width: 10%; vertical-align: middle;"> ${{  datos_finales.0.1|floatformat:0|intcomma }}</td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;"> ${{  datos_finales.0.2|floatformat:0|intcomma }}</td> 
                    <td style="width: 10%; vertical-align: middle;"> {{  datos_finales.0.3|floatformat:0|intcomma }}% </td> 
                    


                </tr>
            </tbody>

            <tbody>
    
                <tr class = "table-light">
                    <td style="width: 15%; vertical-align: middle;" colspan="2"> DESCUENTO SOBRE UNID. (6%)</td>
                    <td  class="priority-5" style="width: 5%; vertical-align: middle;"></td>  
                    <td  class="priority-5" style="width: 10%; vertical-align: middle;"></td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;">  - ${{ datos_finales.0.4|floatformat:0|intcomma }} </td> 
                    <td style="width: 10%; vertical-align: middle;"></td> 
                    


                </tr>
            </tbody>

            <tbody>
    
                <tr class = "table-light">
                    <td style="width: 15%; vertical-align: middle;" colspan="2"> RETIROS REALIZADOS </td>
                    <td  class="priority-5" style="width: 5%; vertical-align: middle;"></td>  
                    <td  class="priority-5" style="width: 10%; vertical-align: middle;"></td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;">  - ${{ datos_finales.0.7|floatformat:0|intcomma }} </td> 
                    <td style="width: 10%; vertical-align: middle;"></td> 
                    


                </tr>
            </tbody>

            <tbody>
    
                <tr class = "table-dark">
                    <td style="width: 15%; vertical-align: middle;" colspan="2"> <b>RESULTADO SIN RETIROS</b> </td>
                    <td  class="priority-5" style="vertical-align: middle;"></td>  
                    <td   class="priority-5"style="vertical-align: middle;"></td> 
                    <td style="width: 10%; vertical-align: middle; vertical-align: middle;"> <b>${{datos_finales.0.6|floatformat:0|intcomma }}</b></td> 
                    <td style="width: 10%; vertical-align: middle;"> <b>{{  datos_finales.0.5|floatformat:0|intcomma }}%</b>  </td> 
                    


                </tr>
            </tbody>


        </table> 


          
   </div>

   <b><hr class = "my-4" style="width: 100%; "></b> 

   <div style="margin-bottom: 2rem;">
    <h5 style="font-family: Arial, Helvetica, sans-serif;">Detalle grafico</h5>
</div>

    <div style="margin-top: 0.5rem; width: 100%;">

        <div style= "text-align: center;">
            <small><strong>-- Analisis historico del margen --</strong></small>
        </div>

        <canvas id="myChart" height="70px" width="auto"></canvas>


    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'line',

            // The data for our dataset
            data: {

                labels: [
                    {% for i in fechas %}
                    '{{i}}',                   
                    {% endfor %}
                    'Hoy'
                    ],
                datasets: [

                {
                    label: 'Retiro de socios',
                    backgroundColor: 'rgb(223, 48, 26, 0.8)',
                    borderColor: 'rgb(223, 48, 26)',
                    fill: true,
                    borderWidth: 1,
                    lineTension: 0,
                    data: [
                    {% for i in datos_registro %}
                    Math.round({{i.2|floatformat:0}}/1000000),                   
                    {% endfor %}
                    Math.round({{ datos_finales.0.7|floatformat:0 }}/1000000),
                    ]
                },

                {
                    label: 'Margen con descuento',
                    backgroundColor: 'rgb(46, 86, 202 , 0.5)',
                    borderColor: 'rgb(46, 86, 202)',
                    fill: true,
                    borderWidth: 1,
                    lineTension: 0,
                    data: [
                    {% for i in datos_registro  %}
                    Math.round({{i.1.0.6|floatformat:0}}/1000000),  
                                     
                    {% endfor %}
                    Math.round({{ datos_finales.0.6|floatformat:0 }}/1000000),
                    ]
                },

                {
                    label: 'Margen total',
                    backgroundColor: 'rgb(28, 180, 51, 0.2)',
                    borderColor: 'rgb(28, 180, 51)',
                    fill: true,
                    borderWidth: 1,
                    lineTension: 0,
                    data: [
                    {% for i in datos_registro %}
                    Math.round({{i.1.0.2|floatformat:0}}/1000000),                   
                    {% endfor %}
                    Math.round({{ datos_finales.0.2|floatformat:0 }}/1000000),
                    ]
                },
                
                ],

            },

            // Configuration options go here
            options: {

                scales: {

                    xAxes: [
                        {

                            stacked: true,
                            display: false,

                        }
                    ],
                    yAxes: [
                        {
                            ticks: {
                                min: 0,
                                stepSize: 50,
                                callback: function(label, index, labels) {
                                    return '$ '+label+ ' M';
                                    
                                }
                            },
                            scaleLabel: {
                                display: true,
                                labelString: '1M = $1.000.000'
                            },

                            stacked: false
                        }
                    ],
                },
            }

        });
        

        
    </script>


    </div>

    <div style="margin-top: 5px;">

        <div style= "text-align: center;">
            <small><strong>-- Historico del ingreso/costo conjunto --</strong></small>
        </div>

        <canvas id="myChart2" height="70px" width="auto"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script>
        var ctx = document.getElementById('myChart2').getContext('2d');
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'line',

            // The data for our dataset
            data: {
                labels: [
                    {% for i in fechas %}
                    '{{i}}',                   
                    {% endfor %}
                    'Hoy'
                    ],
                datasets: [{
                    label: 'Costo del proyecto',
                    backgroundColor: 'rgb(225, 40, 28 , 0.3)',
                    borderColor: 'rgb(225, 40, 28 )',
                    fill: true,
                    borderWidth: 1,
                    lineTension: 0,
                    data: [
                    {% for i in datos_registro  %}
                    Math.round({{i.1.0.1|floatformat:0}}/1000000),
                    {% endfor %}  
                    Math.round({{ datos_finales.0.1|floatformat:0 }}/1000000),                 
                    
                    ]
                },
                {
                    label: 'Ingresos del proyecto',
                    backgroundColor: 'rgb(28, 180, 51, 0.15)',
                    borderColor: 'rgb(28, 180, 51)',
                    fill: true,
                    borderWidth: 1,
                    lineTension: 0,
                    data: [
                    {% for i in datos_registro %}
                    Math.round({{i.1.0.0|floatformat:0}}/1000000),                   
                    {% endfor %}
                    Math.round({{ datos_finales.0.0|floatformat:0 }}/1000000),
                    ]
                }],

            },

            // Configuration options go here
            options: {

                scales: {

                    xAxes: [
                        {

                            stacked: true,
                            display: false,

                        }
                    ],
                    yAxes: [
                        {
                            ticks: {
                                min: 0,
                                stepSize: 800,
                                callback: function(label, index, labels) {
                                    return '$ '+label + ' M';
                                    
                                }
                            },
                            scaleLabel: {
                                display: true,
                                labelString: '1 M = $1.000.000'
                            },

                            stacked: false
                        }
                    ],
                },
                }
        });
        

        
    </script>


    </div>

    <div>
        <p style="font-family: Arial, Helvetica, sans-serif;"> <small>-- Link<strong>P</strong> --</small> </p>

     </div>


</div>
{% endblock %}