{% extends "users/inicio.html" %}

{% load static %}
{% load humanize %}

{% block content %}

<div class = "jumbotron" style="background-color: white; margin-bottom: 0px;">

    <h3 style="text-align: center; color: #17B5B5 ;">Registros de compras</h3>
    <h6 style="text-align: center; color: #17B5B5 ;">Detalle las compras de todos los proyectos</h6>
     <b><hr class = "my-4" style="width: 75%; border-color: #17B5B5 ;"></b>

     <form method="POST" style="text-align: center;">

        {% csrf_token %}

        <div style="display: inline-block; margin-left: 1rem;">

            <label for="palabra"><h6>Buscar</h6></label>

        </div>
        
        <div style="display: inline-block; margin-left: 1rem; ">

            <input name="palabra" type="text" class="form-control form-control" placeholder="Buscar por palabra" list="art" style="width: 30rem;">

        </div>

        <div>
            <button class="btn btn-info" type="submit" style="margin-top: 1%;">Buscar</button>          
        </div>       

     </form>

     <b><hr class = "my-4" style="width: 100%; border-color: #17B5B5 ;"></b>
     <div style="margin-bottom: 1%; text-align: center;">
        <a href="/compras/cargacompras"><button class="btn btn-success" type="submit">Cargar compras</button></a>  
     </div>

    {% if compras %} 

    <table class = "table table-hover" style="text-align: center;">
        <thead>

            <tr class = "table-info">
                <th scope = "row" style="vertical-align: middle;"> <small> <strong>PROYECTO</strong> </small> </th>
                <th scope = "row" style="vertical-align: middle;"><small> <strong>PROVEEDOR</strong> </small> </th>
                <th scope = "row" style="vertical-align: middle;"> <small> <strong>TIPO</strong> </small></th>
                <th scope = "row" style="vertical-align: middle;"> <small> <strong>ARTICULO (UNIDAD)</strong> </small></th>
                <th scope = "row" style="vertical-align: middle;"> <small> <strong>CANTIDAD</strong> </small> </th>
                <th scope = "row" style="vertical-align: middle;"> <small> <strong>PRECIO</strong> </small> </th>
                <th scope = "row" style="vertical-align: middle;"> <small> <strong>TOTAL</strong> </small> </th>
                <th scope = "row" style="vertical-align: middle;"> <small> <strong>V</strong> </small> </th>  
                <th scope = "row" style="vertical-align: middle;"> <small> <strong>FECHA DE LA OC</strong> </small> </th>
                <th scope = "row" style="vertical-align: middle;"> <small> <strong>DOCUMENTO</strong> </small> </th>
                
            </tr>
        </thead>

        <tbody>
           
            {% for i in compras|slice:"20" %}
            <tr class = "table-light">
                <td style="width: 8%;"> <small> <strong>{{i.1.proyecto}}</strong></small></td>              
                <td style="width: 8%;"> <small>{{i.1.proveedor}}</small></td>
                <td style="width: 5%;"> <small>{{i.1.tipo}}</small></td>
                <td style="width: 20%;"><small>{{i.1.articulo}} ({{i.1.articulo.unidad}})</small> </td>
                <td style="width: 5%;"> <small>{{i.1.cantidad|floatformat:2}}</small></td>
                <td style="width: 5%;"> <small>${{i.1.precio|floatformat:2}}</small></td>
                
                {% if i.0 == 2 %}

                <td style="width: 5%; color: #DE3521;"> <span class="hint--top hint--error" aria-label="Precio objetivo era: ${{i.1.precio_presup|floatformat:2}}"> <small> <strong>${{i.2|floatformat:0|intcomma}}</strong> </small></span> </td>
                <td style="width: 3%; color: #DE3521;"> <span class="hint--top hint--error" aria-label="Precio objetivo era: ${{i.1.precio_presup|floatformat:2}}"> <small> <strong>↑{{i.3|floatformat:2}}%</strong> </small></span> </td>
                
                {% elif i.0 == 1 %}

                <td style="width: 5%;"> <span class="hint--top hint--info" aria-label="Mismo precio que la base!"> <small> <strong>${{i.2|floatformat:0|intcomma}}</strong> </small></span> </td>
                <td style="width: 3%;"> <span class="hint--top hint--info" aria-label="Mismo precio que la base!"> <small> <strong>={{i.3|floatformat:2}}%</strong> </small></span> </td>
                
                
                {% else %}
                <td style="width: 5%; color: #4FA429 ;"><span class="hint--top hint--success" aria-label="Bien comprado! Precio objetivo era: ${{i.1.precio_presup|floatformat:2}}"><small> <strong>${{i.2|floatformat:0|intcomma}}</strong> </small></span></td>
                <td style="width: 3%; color: #4FA429 ;"> <span class="hint--top hint--error" aria-label="Precio objetivo era: ${{i.1.precio_presup|floatformat:2}}"> <small> <strong>↓{{i.3|floatformat:2}}%</strong> </small></span> </td>
                
                
                {% endif %}
                
                <td style="width: 10%;"> <small>{{i.1.fecha_c}}</small> </td>
                <td style="width: 15%;"> <small>{{i.1.documento}}</small> </td>
                          
            </tr>
        </tbody>

            {% endfor %}

        </table>

        <div>
            <small>El listado puede continuar, el maximo de filas visibles es de 20</small>
        </div>

            <div style="text-align: center;">
                <p> <small>-- Link<strong>P</strong> --</small> </p>
        
             </div>

     {% else %}
            <div style="text-align: center;">
                <h3>No existe registros actualmente</h3>
            </div>
            

    {% endif %}
        
    

                    
</div>
 
    
{% endblock %}