{% extends "users/inicio.html" %}

{% load static %}
{% load humanize %}

{% block content %}

<div class = "jumbotron" style="background-color: white; margin-bottom: 0px; text-align: center;">

    <h3 style="font-family: Arial, Helvetica, sans-serif;">Solicitudes de compras</h3>
    <small style="font-family: Arial, Helvetica, sans-serif;"><b>Modulo:</b> Circuito de compras </small>

     <div style="text-align:center">
                  
    </div> 


    <b><hr class = "my-4" style="width: 100%;"></b>

    <div style="text-align: left;">

    <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
        <button type="button" class="btn btn-primary">Estado</button>
        <div class="btn-group" role="group">
            <button id="btnGroupDrop1" type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
            <div class="dropdown-menu" aria-labelledby="btnGroupDrop1" style="">
                <div style="margin: 2px;">

                    <a href="{% url 'Comparativas' 0 %}" style="margin-top: 5px;" >Todas</a>

                </div>
                <div style="margin: 2px;">

                    <a href="{% url 'Comparativas' 1 %}" style="margin-top: 5px; color: rgb(83, 82, 65);" >En espera</a>

                </div>

                <div style="margin: 2px;">

                    <a href="{% url 'Comparativas' 2 %}" style="margin-top: 5px; color: rgb(208, 125, 32);" >Adjunto autorizado</a> 
                
                </div>

                <div style="margin: 2px;">

                    <a href="{% url 'Comparativas' 4 %}" style="margin-top: 5px; color: rgb(37, 159, 76 );" >Autorizadas</a>
                
                </div>

                <div style="margin: 2px;">

                    <a href="{% url 'Comparativas' 3 %}" style="margin-top: 5px; color: rgb(192, 63, 50 );" >Rechazadas</a>
                
                </div>
                
                
                             
                
                
            </div>
        </div>
        </div>



    <a href= "{% url 'Cargar O.C para autorizar' %}" class="btn btn-outline-info"style="text-align: end; margin-top: 5px;" > <b>+</b> Nueva solicitud</a>


    <a href= "{% url 'Descargar estado' %}" class="btn btn-outline-success" style="text-align: end; margin-top: 5px;" > <img src="{% static 'img/sobresalir.png' %}" alt="" style="max-width:20px; height:auto;"  > Descargar Excel</a>


    </div>


     
    {% if datos %} 
       
        <table class = "table table-hover" style="text-align: center; margin-top: 5px;" >
            <thead>
    
                <tr class = "table-dark">
                    <th scope = "row" style="vertical-align: middle;" ><small><b></b></small></th>
                    <th scope = "row" style="vertical-align: middle;" ><small><b></b></small></th>
                    <th scope = "row" style="vertical-align: middle;" class="priority-5"><small><b>Nº REF</b></small></th>
                    <th scope = "row" style="vertical-align: middle;" class="priority-4"> <small><b>Nº O.C</b></small></th>
                    <th scope = "row" style="vertical-align: middle;"> <small><b>PROVEEDOR</b></small></th>
                    <th scope = "row" style="vertical-align: middle;" class="priority-4"> <small><b>PROYECTO</b></small> </th>
                    <th scope = "row" style="vertical-align: middle;" class="priority-4"><small><b>MONTO</b></small></th>
                    <th scope = "row" style="vertical-align: middle;" class="priority-3"><small><b>ESTADO</b></small></th>
                    <th scope = "row" style="vertical-align: middle;" class="priority-4"><small><b>FECHA</b></small></th>
                    <th scope = "row" style="vertical-align: middle;"><small><b>ARCHIVO</b></small></th>
                    <th scope = "row" style="vertical-align: middle;"><small><b>O.C</b></small></th>

                    {% if request.user.username == "PL" or request.user.username == "AR" or request.user.username == "ar" or request.user.username == "ar" or request.user.username == "SP" %}

                    <th scope = "row" style="vertical-align: middle;"><small><b>AUTORIZAR</b></small></th>
                    
                    {% endif %}

                </tr>
            </thead>

               
    
            <tbody>

                
               
                {% for i in datos|slice:"120" %}

                <tr class = "table-light">
                    
                    <td style="width: 1%;" > <small> <strong> <a href="{% url 'Mensajes en comparativas' i.id%}"><img src="{% static 'img/conversacion.png' %}" alt="" style="max-width:20px; height:auto;"  ></a>         
                    </a> </strong></small></td>
                    <td style="width: 1%;" >

                        {% if i.creador %}
                        
                        {{i.creador}}

                        {% endif %}
                    
                    </td>
                    <td style="width: 3%;" class="priority-5"> <small> <strong>{{i.numero|upper}}</strong></small></td>

                    {% if i.adj_oc %}

                    <td style="width: 3%;" class="priority-4"> <small> <strong>{{i.o_c}}</strong></small></td>

                    {% else %}

                    <td style="width: 5%;" class="priority-4"><small>S/C</small> </td>
                    

                    {% endif %}

                    <td style="width: 8%;" > <small>{{i.proveedor.name}}</small> </td>
                        <td style="width: 5%;" class="priority-4" > <small><strong>{{i.proyecto|upper}}</strong></small></td>              
                    <td style="width: 5%;" class="priority-4" ><small>${{i.monto|floatformat:0|intcomma}}</small> </td>

                    {% if i.estado == "ESPERA" %}
                    <td style="width: 5%; color: rgb(83, 82, 65);" class="priority-3" >  <small><strong>{{i.estado}}</strong></small></td>

                    {% endif %}

                    {% if i.estado == "AUTORIZADA" %}




                    <td style="width: 5%; color: rgb(37, 159, 76 );" class="priority-3">  

                    {% if i.comentario %}
                        
                        
                    <span class="hint--left hint--danger"aria-label="{{i.comentario}}">

                    {% endif %}
                    
                    
                    
                    
                    <small><strong>O.C AUTORIZADA</strong></small>

                    {% if i.comentario %}
                    
                </span>

                {% endif %}
                
                
                </td>

  
        
                    
                    {% endif %}

                    {% if i.estado == "NO AUTORIZADA" %}
                    <td style="width: 4%; color: rgb(192, 63, 50 );"  class="priority-3">


                        {% if i.comentario %}
                        
                        
                        <span class="hint--left hint--danger" aria-label="{{i.comentario}}">

                            {% endif %}
                        
                        
                        <small><strong>RECHAZADA</strong></small>

                        {% if i.comentario %}
                    
                            </span>

                            {% endif %}
                    
                    </td>

                    {% endif %}

                    {% if i.estado == "ADJUNTO ✓" %}
                    <td style="width: 4%; color: rgb(208, 125, 32);"  class="priority-3">


                        {% if i.comentario %}
                        
                        
                        <span class="hint--left hint--danger" aria-label="{{i.comentario}}">

                            {% endif %}
                        
                        
                        <small><strong>ADJUNTO AUTORIZADO</strong></small>

                        {% if i.comentario %}
                    
                            </span>

                            {% endif %}
                    
                    </td>

                    {% endif %}
                    <td style="width: 9%;" class="priority-4"><small>{{i.fecha_c}}</small> </td>
                    <td style="width: 5%;"><a href="{{ i.adjunto.url }}" class="btn btn-sm btn-warning"><span class="hint--left hint--warning" aria-label="Es una imagen de comparativas o remitos!">VER</span></a></td>
                    
                    {% if i.adj_oc %}
                    
                    <td style="width: 3%;"><a href="{{ i.adj_oc.url }}" class="btn btn-sm btn-success"><span class="hint--left hint--success" aria-label="Una copia de la O.C!, puedes buscarla en TANGO tambien!">VER</span></a></td>
                    
                    {% else %}

                    <td style="width: 3%;"><small>S/C</small> </td>

                    {% endif %}

                    {% if request.user.username == "PL" or request.user.username == "AR" or request.user.username == "ar" or request.user.username == "SP" %}

                    <td style="width: 8%;" >
                        
                        <form action="" method="POST">
                            {% csrf_token %}


                            {% if estado == "0" or estado == "1" or estado == "3" %}

                            <div style="display: inline-block; max-width: 45%;">

                                <button class="btn btn-sm btn-warning" type="submit"  name = "ADJAPROB" value="{{i.id}}"><span class="hint--left hint--warning" aria-label="El adjunto esta Ok!">✓</span></button>

                            </div>

                            {% endif %}

                            {% if estado == "0" or estado == "2" or estado == "3" %}

                            <div style="display: inline-block; max-width: 45%;">

                                <button class="btn btn-sm btn-success" type="submit"  name = "APROBADA" value="{{i.id}}"><span class="hint--left hint--success" aria-label="Esta todo listo para el pago!">✓</span></button>

                            </div>

                            {% endif %}

                            <div style="display: inline-block; max-width: 45%;">

                                <button class="btn btn-sm btn-danger" type="submit" name = "NO APROBADA" value="{{i.id}}"><span class="hint--left hint--danger" aria-label="Deja un comentario para que revisen!">X</span></button>
                            
                            </div>

                            
                            
                            <div class="form-group" style="margin-top: 10%;">


                                <input type="text" name="{{request.user.username}}" class="form-control form-control-sm" placeholder="Comentario" id="inputDefault">
                        

                            </div>

                        </form>
                        

                    {% endif %}

                    
                {% endfor %}
            </tbody>
             
    
            </table>
    
    <b><hr class = "my-4" style="width: 100%;"></b>


     {% else %}
            <div style="margin-top: 2rem;">
                <h7>No hay solicitudes!</h7>
            </div>

            {% endif %}

            <b><hr class = "my-4" style="width: 75%;"></b>


            



    <div style="margin-top: 2rem;">
        <p> <small>-- Link<strong>P</strong> --</small> </p>

     </div>
        
    

                    
</div>
 
    
{% endblock %}