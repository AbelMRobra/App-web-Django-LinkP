{% extends "users/inicio2.html" %}

{% load static %}
{% load humanize %}

{% block content %}

<div class="container-fluid">
    <!-- ============================================================== -->
    <!-- Cabeza de la pagina -->
    <!-- ============================================================== -->
    <div class="row page-titles">
        <div class="col-md-5 align-self-center">
            <h3 class="text-themecolor">Check de ordenes autorizadas</h3>
        </div>

        <div class="col-md-7 align-self-center">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'Inicio' %}">Inicio</a></li>
                <li class="breadcrumb-item"><a href="{% url 'Principal compras' %}">Panel</a></li>
                <li class="breadcrumb-item">Check</li>

            </ol>
        </div>

    </div>

  </div>

  <div class="col-lg-12 col-xlg-6 button-group">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Listado de ordenes autorizadas</h4>
            <h6 class="card-subtitle">Todas las OC estan autorizadas por un socio gerente</h6>

            <div style="text-align: left;">

                <a href= "{% url 'Comparativas' 5 0 %}" class="btn waves-effect waves-light text-success"style="text-align: end; margin-top: 5px;" >Ordenes a firmar</a>
        
                <div class="btn-group">
                    <button type="button" class="btn dropdown-toggle text-primary ml-2"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="myFunction()">
                        Estado
                    </button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="{% url 'OC autorizadas' 0 %}">Todas</a>
                        <a class="dropdown-item" href="{% url 'OC autorizadas' 2 %}">Observadas</a>
                        <a class="dropdown-item" href="{% url 'OC autorizadas' 4 %}">Vistas</a> 
                        <a class="dropdown-item" href="{% url 'OC autorizadas' 3 %}">No vistas</a>

                    </div>
                </div>

            <div class ="dataTables_filter">

                <form method="POST">
        
                    {% csrf_token %}
                <label>
                    Buscar:
                    <input type="search" class placeholder aria-controls="example23" name="palabra">
                </label>

            </form>

            </div>

            {% if datos %} 

            <div class="table-responsive">

                <table class="table">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Proveedor</th>
                            <th>O.C</th>
                            <th>Valor</th>
                            {% if request.user.username == "SP" or request.user.username == "AR" or request.user.username == "ar" %}
                            <th>Check</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>

                        {% for i in datos|slice:"120" %}
                        <tr>
                            <td>
                                <span class="round round-primary"><img src="{{i.0.imagenlogo.url}}"  alt="user" width="50"></span>
                                <h6 class="card-subtitle" style="font-size: 12px; margin-top: 2px;"><span class="text-muted"> {{i.2.fecha_c|date:"d/m/Y"}}</span></h6></td>
                                </td>
                            <td>{{i.2.proveedor.name|lower|capfirst}} 
                                <h6 class="card-subtitle" style="font-size: 14px; margin-top: 2px;">
                                <a href="{% url 'Mensajes en comparativas' i.2.id %}" class=" fa fa-comments-o fa-lg"></a>
                                <a href="{{ i.2.adjunto.url }}" class=" fa fa-paperclip fa-lg"></a> 
                                {% if i.2.adj_oc %}
                                <a href="{{ i.2.adj_oc.url }}"><img src="{% static 'img/OC.png' %}" style="max-width:20px; height:auto;"></a>
                                {% endif %}
                                {{i.2.proyecto|lower|capfirst}} - {{i.2.numero|lower|capfirst}}</h6>
                            </td>
                            <td>
                                <div>{{i.2.o_c|upper}}</div>
                                
                                <div class="label label-table label-success">PL</div>
                                {% if i.2.estado == "ESPERA" %}
                                <div class="label label-table label-info">Espera</div></td>
                                
            
                                {% endif %}
            
                                {% if i.2.visto == "VISTO" %}
            
                                <div class="label label-table label-success">SP</div> </td>
                                                          
    
                                {% endif %}
            
                                {% if i.2.visto == "NO_VISTO" or i.2.visto == Null %}
                                <div class="label label-table label-danger">No vista</div> </td>
            
                                {% endif %}
            
                                {% if i.2.visto == "VISTO NO CONFORME" %}
                                <div class="label label-table label-warning">Observada</div> </td>
            
                                {% endif %}
                                <td>${{i.2.monto|floatformat:0|intcomma}}</td> 

                            {% if request.user.username == "SP" or request.user.username == "AR" or request.user.username == "ar" %}
                            <td>
                        
                                <form action="" method="POST">
                                    {% csrf_token %}
        
                                    <div style="display: inline-block; max-width: 45%;">
        
                                        <button class="btn btn-sm btn-success" type="submit"  name = "APROBADA" value="{{i.2.id}}"><span class="hint--left hint--success" aria-label="Todo OK!">✓</span></button>
        
                                    </div>
        
                                    <div style="display: inline-block; max-width: 45%;">
        
                                        <button class="btn btn-sm btn-warning" type="submit"  name = "ADJAPROB" value="{{i.2.id}}"><span class="hint--left hint--warning" aria-label="Puedes dejar una consulta!, esta acción no frenara el circuito de pago!">?</span></button>
        
                                    </div>
        
        
                                </form>
        
                            </td>
                            {% endif %}
                        </tr>
                                

                        {% endfor %}

                    </tbody>
             
    
                </table>


            {% endif %}
            </div>
            </div>
        </div>
    </div>
</div>



<script src="https://code.jquery.com/jquery-3.5.1.js"></script>


<script>
     
$(window).scroll(function () {
            sessionStorage.scrollTop = $(this).scrollTop();
        });
        $(document).ready(function () {
            if (sessionStorage.scrollTop != "undefined") {
                $(window).scrollTop(sessionStorage.scrollTop);
            }
        });
</script>

 
    
{% endblock %}