{% extends "users/inicio.html" %}

{% load static %}

{% block content %}

<div class = "jumbotron" style="background-color: white; margin-bottom: 0px;">

    <div style="text-align: center;">

      <h3 style="color: rgb({{datos.0.0.color}}); font-family: Arial, Helvetica, sans-serif;">Panel principal de presupuestos {{datos.0.0.nombre}}</h3>

    
      {% if datos %}


      <small style="color: rgb({{datos.0.0.color}}); font-family: Arial, Helvetica, sans-serif;"> <b>Superficie estimada:</b> {{datos.0.0.m2|floatformat:0}}m2 </small>
      

      <div>


        <img src="{{datos.0.0.iamgen.url}}"  class="img-fluid" alt="..." style="max-width:200px; height:auto; margin-top: 1rem; margin-bottom: 10px;">
  


      </div>
  
      
    </div>

    {% endif %}

    <div style="text-align: center;">


      <small style="font-family: Arial, Helvetica, sans-serif;"> <b>Modulo:</b> Presupuestos</small>
    


    </div>

    
    
     <b><hr class = "my-4" style="width: 75%; border-color: rgba({{datos.0.0.color}}, 0.5) ;"></b>

     {% if datos %}

     <div style="text-align: center;">
        <p style="font-family: Arial, Helvetica"> <small>-- Accede a la información haciendo <strong>click</strong> sobre el valor de reposición o el saldo --</small> </p>

     </div>

     {% endif %}

     {% if proyectos %}

     <div style="text-align: center; margin-bottom: 20%;">
        <form method="POST">

            {% csrf_token %}

            <div>
              <small style="font-family: Arial, Helvetica, sans-serif;"> Seleccione un proyecto del listado para acceder a los datos</small>

            </div>

            <select name="proyecto" class="custom-select" style="width: 200px; margin-top: 10px;">

                {% if request.user.username != "HC" %}

                {% for i in proyectos %}
                <option value="{{i.id}}">{{i.nombre}}</option>

                {% endfor %}

                {% else %}

                {% for i in proyectos %}

                {% if "DIANCO" in i.nombre %}
                <option value="{{i.id}}">{{i.nombre}}</option>

                {% endif %}

                {% endfor %}

                
                {% endif %}


              </select>
              
              

              <div>
                <button class="btn btn-dark" type="submit" style="margin-top: 10px;">Buscar datos</button>          
            </div>
            
        </form>

        
        
    </div>

    {% endif %}

    {% if datos %}

     <b><hr class = "my-4" style="width: 100%; border-color: rgba({{datos.0.0.color}}, 0.5) ;"></b>

     <div style="text-align: center; margin-top: 3%; margin-bottom: 1.5%;">

      <h6 style="font-family: Arial, Helvetica, sans-serif;"> Avance del presupuesto: {{datos.0.3|floatformat:2}}% </h6>
   </div>

   <div class="progress" style="margin-bottom: 2%; width: 60%; margin-left: 20%;">
      <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0.{{datos.0.3|floatformat:0}}" aria-valuemin="0" aria-valuemax="100" style="width: {{datos.0.3|floatformat:0}}%"></div>
    </div>

     <a href="{% url 'Panel de presupuestos por capitulo' datos.0.0.id %}" style="color: black;">
     <div style="text-align: center;">

        <div class="card text-white bg-dark mb-3" style="display: inline-block; width: 300px; height: 150px;">
          
            <div class="card-body">
              <h4 class="card-title" style="font-family: Arial, Helvetica, sans-serif;">Valor de reposición</h4>
              <h6 style="font-family: Arial, Helvetica, sans-serif;">${{datos.0.1|floatformat:2}} Millones</h6>
              <small style="font-family: Arial, Helvetica, sans-serif;">El valor del proyecto neto actualizado</small>
            </div>
          </div>
    
        </a>

    <a href="{% url 'Saldo por capitulo' datos.0.0.id %}" style="color: black;">
    
        <div class="card text-white bg-dark mb-3" style="display: inline-block; width: 300px; height: 150px; ">
              
            <div class="card-body">
                <h4 class="card-title" style="font-family: Arial, Helvetica, sans-serif;">Saldo del proyecto</h4>
                <h6 style="font-family: Arial, Helvetica, sans-serif;">${{datos.0.2|floatformat:2}} Millones</h6>
                <small style="font-family: Arial, Helvetica, sans-serif;">Todas las partidas pendientes</small>
            </div>
          </div>

        </a>
    
        </div>
        <div style="text-align: center;">

        <a href="{% url 'Creditos de proyectos' datos.0.0.id %}" class="btn btn-outline-dark">Creditos varios</a>
        <a href="{% url 'Fondos de reparo' datos.0.0.id %}" class="btn btn-outline-dark">Fondos de reparo</a>
        <a href="{% url 'Anticipos' datos.0.0.id %}"  class="btn btn-outline-dark">Anticipos Finan</a>
        
        </div>

        
    

        <b><hr class = "my-4" style="width: 100%; border-color: rgba({{datos.0.0.color}}, 0.5) ;"></b>

      <div style="text-align: center; margin-top: 3%; margin-bottom: 1.5%;">

        <h6 style="font-family: Arial, Helvetica, sans-serif;"> Variación del presupuesto del proyecto </h6>
        <small style="font-family: Arial, Helvetica, sans-serif;">Precio expresado en millones de pesos</small>
     </div>

     <div style="width: 90%; text-align: center;">

      <canvas id="myChart"></canvas>


     </div>

      
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script>
        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'line',

            // The data for our dataset
            data: {
                labels: [
                    {% for i in valor %}
                    '{{i.0}}',                   
                    {% endfor %}
                    'Hoy',],
                datasets: [
                {
                    label: 'Valor de reposición mes a mes',
                    backgroundColor: 'rgb({{datos.0.0.color}})',
                    borderColor: 'rgb({{datos.0.0.color}})',
                    fill: false,
                    data: [
                    {% for i in valor %}
                    {{i.1|floatformat:0}},                   
                    {% endfor %}{{datos.0.1|floatformat:0}},
                    ]
                },
                ],

            },

            // Configuration options go here
            options: {}
        });
    </script>

        
    
        
    {% endif %}
    <div style="text-align: center; margin-top: 2%;">
        <p style="font-family: Arial, Helvetica, sans-serif;"> <small>-- Link<strong>P</strong> --</small> </p>

     </div>

   
                    
</div>
 
    
{% endblock %}